% Copyright 2006 by Till Tantau
%
% This file may be distributed and/or modified
%
% 1. under the LaTeX Project Public License and/or
% 2. under the GNU Public License.
%
% See the file doc/generic/pgf/licenses/LICENSE for more details.

\ProvidesFileRCS[v\pgfversion] $Header: /cvsroot/pgf/pgf/generic/pgf/libraries/Attic/pgflibrarytikzcalendar.code.tex,v 1.1 2007/02/02 12:55:51 tantau Exp $


% Translation stuff

\ifx\translate\@undefined
  \def\translate#1{#1}
\fi

% Load month dictionary, if possible

\ifx\usedictionary\@undefined
\else
  \usedictionary{translator-months-dictionary}
\fi



% Convert a date to the number of days since January 1st, 2000 (which
% was a Sunday)
%
% #1 = date in the ISO format (like 2006-11-10)
% #2 = counter that should be set to the number of days
%
% Example:
%
% \pgfcalendardatetonumber{2006-01-10}{\mycount}

\def\pgfcalendardatetonumber#1#2{\edef\pgf@temp{#1}\expandafter\pgfcalendar@datetonumber\pgf@temp/{#2}}
\def\pgfcalendar@datetonumber#1-#2-#3/#4{%
  {%
    %
    % Store year, month and days.
    % 
    \c@pgf@counta=#1\relax%
    \c@pgf@countb=#2\relax%
    \c@pgf@countc=#3\relax%
    %
    % Store final result in \c@pgf@countd
    %
    \advance\c@pgf@countc by -1\relax%
    \c@pgf@countd=\c@pgf@countc\relax%
    % 
    %
    % Add number of days in year contributed by the given month. 
    %
    \advance\c@pgf@countb by -1\relax%
    \advance\c@pgf@countd by \ifcase\c@pgf@countb 0\or31\or59\or90\or120\or151\or181\or212\or243\or273\or304\or334\or365\fi
    %
    % Add number of days in years since the given year
    %
    \advance\c@pgf@counta by -1600\relax%
    \advance\c@pgf@countd by-146096\relax%%
    %
    % Act, as if the current year began on March 1st...
    \ifnum\c@pgf@countb<2\relax%
      \advance\c@pgf@counta by -1\relax%
      \advance\c@pgf@countd by365\relax%
    \fi%
    %
    \multiply\c@pgf@counta by 365\relax%
    \advance\c@pgf@countd by \c@pgf@counta\relax%
    \divide\c@pgf@counta by 365\relax%
    % Take leap years into account:
    \divide\c@pgf@counta by 4\relax%
    \advance\c@pgf@countd by\c@pgf@counta\relax%
    % Subtract 100-year exception:
    \divide\c@pgf@counta by 25\relax%
    \advance\c@pgf@countd by-\c@pgf@counta\relax%
    % Add 400-year exception:
    \divide\c@pgf@counta by 4\relax%
    \advance\c@pgf@countd by\c@pgf@counta\relax%
    %
    \xdef\pgf@temp{\the\c@pgf@countd}%
  }%
  #4=\pgf@temp\relax%
}


% Convert the number of days since January 1st, 2000 to a date. 
%
% #1 = the number of days
% #2 = a macro in which the date should be stored.
%
% Example
%
% \pgfcalendarnumbertodate{\mynumber}{\mydate}

\def\pgfcalendarnumbertodate#1#2{%
  {%
    \c@pgf@countd=#1\relax%
    %
    % Offset to 1st March
    %
    \advance\c@pgf@countd by-60\relax%
    %
    % Calculate modulo 400 years:
    %
    \c@pgf@countb=\c@pgf@countd%
    \c@pgf@countc=\c@pgf@countd%
    \divide\c@pgf@countb by146097\relax%
    \c@pgf@counta=\c@pgf@countb%
    \multiply\c@pgf@counta by400\relax%
    \multiply\c@pgf@countb by-146097\relax%
    \advance\c@pgf@countb by\c@pgf@countc%
    \showthe\c@pgf@counta%
    %
  }%
}



% Returns the day of week as a number between 0 = Monday and 6 =
% Sunday
%
% #1 = a number representing the number of days since January 1st,
%      2000 
% #2 = a counter into which the weekday should be put.
%
% Example:
%
% \pgfcalendardatetonumber{2006-01-10}{\mycount}
% \pgfcalendarnumbertoweekday{\mycount}{\myweekday}

\def\pgfcalendarnumbertoweekday#1#2{%
  \c@pgf@counta=#1\relax%
  \advance\c@pgf@counta by5\relax%
  #2=\c@pgf@counta%
  \divide#2by7\relax%
  \multiply#2by-7\relax%
  \advance#2by\c@pgf@counta\relax%
}



% Converts a day of week into a weekday name (long or short)
%
% #1 = a number representing a weekday (0=Monday)
%
% Example:
%
% \pgfcalendardatetonumber{2006-01-10}{\mycount}
% \pgfcalendarnumbertoweekday{\mycount}{\myweekday}
% October 1st, 2006 was a \pgfcalendarweekdayname{\myweekday}

\def\pgfcalendarweekdayname#1{%
  \translate{\ifcase#1Monday\or Tuesday\or Wednesday\or Thursday\or Friday\or Saturday\or Sunday\fi}%
}

\def\pgfcalendarweekdayshortname#1{%
  \translate{\ifcase#1Mon\or Tue\or Wed\or Thu\or Fri\or Sat\or Sun\fi}%
}



% Converts a month of year number into a month name (long or short)
%
% #1 = a number representing a month (1=January)
%
% Example:
%
% \pgfcalendarmonthname

\def\pgfcalendarmonthname#1{%
  \translate{\ifcase#1\or January\or February\or March\or April\or
    May\or June\or July\or August\or September\or October\or
    November\or December\fi}%
}

\def\pgfcalendarmonthshortname#1{%
  \translate{\ifcase#1\or Jan\or Feb\or Mar\or Apr\or
    May\or Jun\or Jul\or Aug\or Sep\or Oct\or
    Nov\or Dec\fi}%
}



\endinput
