% Copyright 2006 by Till Tantau
%
% This file may be distributed and/or modified
%
% 1. under the LaTeX Project Public License and/or
% 2. under the GNU Public License.
%
% See the file doc/generic/pgf/licenses/LICENSE for more details.

\ProvidesFileRCS[v\pgfversion] $Header: /cvsroot/pgf/pgf/generic/pgf/libraries/Attic/pgflibrarytikzcalendar.code.tex,v 1.2 2007/02/02 13:21:21 tantau Exp $


% Translation stuff

\ifx\translate\@undefined
  \def\translate#1{#1}
\fi

% Load month dictionary, if possible

\ifx\usedictionary\@undefined
\else
  \usedictionary{translator-months-dictionary}
\fi


% Convert a date to the number of days since January 1st, 2000 (which
% was a Sunday)
%
% #1 = date in the ISO format (like 2006-11-10)
% #2 = counter that should be set to the number of days
%
% Example:
%
% \pgfcalendardatetonumber{2006-01-10}{\mycount}

\def\pgfcalendardatetonumber#1#2{\edef\pgf@temp{#1}\expandafter\pgfcalendar@datetonumber\pgf@temp/{#2}}
\def\pgfcalendar@datetonumber#1-#2-#3/#4{%
  {%
    %
    % Store year, month and days.
    % 
    \c@pgf@counta=#1\relax%
    \c@pgf@countb=#2\relax%
    \c@pgf@countc=#3\relax%
    %
    % Store final result in \c@pgf@countd
    %
    \advance\c@pgf@countc by -1\relax%
    \c@pgf@countd=\c@pgf@countc\relax%
    % 
    %
    % Add number of days in year contributed by the given month. 
    %
    \advance\c@pgf@countb by -1\relax%
    \advance\c@pgf@countd by \ifcase\c@pgf@countb 0\or31\or59\or90\or120\or151\or181\or212\or243\or273\or304\or334\or365\fi
    %
    % Add number of days in years since the given year
    %
    \advance\c@pgf@counta by -1600\relax%
    \advance\c@pgf@countd by-146096\relax%%
    %
    % Act, as if the current year began on March 1st...
    \ifnum\c@pgf@countb<2\relax%
      \advance\c@pgf@counta by -1\relax%
      \advance\c@pgf@countd by365\relax%
    \fi%
    %
    \multiply\c@pgf@counta by 365\relax%
    \advance\c@pgf@countd by \c@pgf@counta\relax%
    \divide\c@pgf@counta by 365\relax%
    % Take leap years into account:
    \divide\c@pgf@counta by 4\relax%
    \advance\c@pgf@countd by\c@pgf@counta\relax%
    % Subtract 100-year exception:
    \divide\c@pgf@counta by 25\relax%
    \advance\c@pgf@countd by-\c@pgf@counta\relax%
    % Add 400-year exception:
    \divide\c@pgf@counta by 4\relax%
    \advance\c@pgf@countd by\c@pgf@counta\relax%
    %
    \xdef\pgf@temp{\the\c@pgf@countd}%
  }%
  #4=\pgf@temp\relax%
}


% Convert a date to the Julian day number (number of days since
% January 1st, -4712)
%
% #1 = date in the ISO format (like 2006-11-10)
% #2 = counter that should be set to the number of days
%
% Description:
%
% The conversion is taken from the Wikipedia entry on Julian days. 
%
% Example:
%
% \pgfcalendardatetojulian{2006-01-10}{\mycount}

\def\pgfcalendardatetojulian#1#2{\edef\pgf@temp{#1}\expandafter\pgfcalendar@datetojulian\pgf@temp/{#2}}
\def\pgfcalendar@datetojulian#1-#2-#3/#4{%
  {%
    %
    % Store year, month and days.
    % 
    \c@pgf@counta=#1\relax%
    \c@pgf@countb=#2\relax%
    \c@pgf@countc=#3\relax%
    %
    % Store final result in \c@pgf@countd
    %
    %
    % Compute a = \lfloor (14-month) /12 \rfloor
    %
    \ifnum#2>2\relax%
      \c@pgf@counta=1\relax%
    \else%
      \c@pgf@counta=0\relax%
    \fi%
    %
    % Compute y = year + 4800 - a
    %
    \c@pgf@countb=#1\relax%
    \advance\c@pgf@countb by 4800\relax%
    \advance\c@pgf@countb by-\c@pgf@counta\relax%
    %
    % Compute m = month + 12a - 3
    %
    \c@pgf@countc=#2\relax%
    \advance\c@pgf@countc by 12\c@pgf@counta\relax%
    \advance\c@pgf@countc by-3\relax%
    %
    % Compute jdn = day + \floor{(153 m+2)/5} + 365y + \floor{y/4} -
    % \floor{y/100} + \florr{y/400} - 32045
    %
    \c@pgf@countd=#3\relax%
    % Recycle a
    % + \floor{(153 m+2)/5} :
    \c@pgf@counta=153\c@pgf@countc\relax
    \advance\c@pgf@counta by 2\relax%
    \divide\c@pgf@counta by 5\relax%
    \advance\c@pgf@countd by \c@pgf@counta\relax%
    % + 365y :
    \advance\c@pgf@countd by365\c@pgf@countb\relax%
    % + \floor{y/4}
    \c@pgf@counta=\c@pgf@countb\relax%
    \divide\c@pgf@counta by 4\relax%
    \advance\c@pgf@countd by\c@pgf@counta%
    % - \floor{y/100}
    \c@pgf@counta=\c@pgf@countb\relax%
    \divide\c@pgf@counta by 100\relax%
    \advance\c@pgf@countd by-\c@pgf@counta%
    % + \floor{y/400}
    \c@pgf@counta=\c@pgf@countb\relax%
    \divide\c@pgf@counta by 400\relax%
    \advance\c@pgf@countd by\c@pgf@counta%
    %  - 32045
    \advance\c@pgf@countd by-32405\relax%
    %
    \xdef\pgf@temp{\the\c@pgf@countd}%
  }%
  #4=\pgf@temp\relax%
}


% Convert Julian day number date. 
%
% #1 = the number of Julian days
% #2 = a macro in which the date should be stored.
%
% Formula used:
%
% J = Julian day number
% j = J + 32044
% g = j div 146097
% dg = j mod 146097
% c = (dg div 36524 + 1) * 3 div 4
% dc = dg - c * 36524
% b = dc div 1461
% db = dc mod 1461
% a = (db div 365 + 1) * 3 div 4
% da = db - a * 365
% y = g * 400 + c * 100 + b * 4 + a
% m = (da * 5 + 308) div 153 - 2
% d = da - (m + 4) * 153 div 5 + 122
% Y = y - 4800 + (m + 2) div 12
% M = (m + 2) mod 12 + 1
% D = d + 1
%
% Example
%
% \pgfcalendarjuliantodate{\mynumber}{\mydate}

\def\pgfcalendarjuliantodate#1#2{%
  {%
    \c@pgf@countd=#1\relax%
    %
  }%
}



% Returns the day of week as a number between 0 = Monday and 6 =
% Sunday
%
% #1 = a number representing the number of days since January 1st,
%      2000 
% #2 = a counter into which the weekday should be put.
%
% Example:
%
% \pgfcalendardatetonumber{2006-01-10}{\mycount}
% \pgfcalendarnumbertoweekday{\mycount}{\myweekday}

\def\pgfcalendarnumbertoweekday#1#2{%
  \c@pgf@counta=#1\relax%
  \advance\c@pgf@counta by5\relax%
  #2=\c@pgf@counta%
  \divide#2by7\relax%
  \multiply#2by-7\relax%
  \advance#2by\c@pgf@counta\relax%
}



% Converts a day of week into a weekday name (long or short)
%
% #1 = a number representing a weekday (0=Monday)
%
% Example:
%
% \pgfcalendardatetonumber{2006-01-10}{\mycount}
% \pgfcalendarnumbertoweekday{\mycount}{\myweekday}
% October 1st, 2006 was a \pgfcalendarweekdayname{\myweekday}

\def\pgfcalendarweekdayname#1{%
  \translate{\ifcase#1Monday\or Tuesday\or Wednesday\or Thursday\or Friday\or Saturday\or Sunday\fi}%
}

\def\pgfcalendarweekdayshortname#1{%
  \translate{\ifcase#1Mon\or Tue\or Wed\or Thu\or Fri\or Sat\or Sun\fi}%
}



% Converts a month of year number into a month name (long or short)
%
% #1 = a number representing a month (1=January)
%
% Example:
%
% \pgfcalendarmonthname

\def\pgfcalendarmonthname#1{%
  \translate{\ifcase#1\or January\or February\or March\or April\or
    May\or June\or July\or August\or September\or October\or
    November\or December\fi}%
}

\def\pgfcalendarmonthshortname#1{%
  \translate{\ifcase#1\or Jan\or Feb\or Mar\or Apr\or
    May\or Jun\or Jul\or Aug\or Sep\or Oct\or
    Nov\or Dec\fi}%
}



\endinput
