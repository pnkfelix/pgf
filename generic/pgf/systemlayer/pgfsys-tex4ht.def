\ProvidesFileRCS $Header: /cvsroot/pgf/pgf/generic/pgf/systemlayer/pgfsys-tex4ht.def,v 1.4 2005/07/10 20:11:24 tantau Exp $

% Copyright 2005 by Till Tantau <tantau@cs.tu-berlin.de>.
%
% This program can be redistributed and/or modified under the terms
% of the GNU Public License, version 2.




% Driver commands for tex4ht

%
% Load common pdf commands:
%
\input pgfsys-common-svg.def

%
% tex4ht-specific stuff:
%
\def\pgfsys@invoke#1{\HCode{#1}}

\newcount\pgf@sys@svg@picnum

\newdimen\pgfsvgextraborder
\pgfsvgextraborder=.5pt

\def\pgfsys@beginpicture#1#2#3#4{%
  \global\advance\pgf@sys@svg@picnum by 1\relax%
  % Ok, compute width/height
  \pgf@xa=#1%
  \advance\pgf@xa by-\pgfsvgextraborder%
  \pgf@ya=#2%
  \advance\pgf@ya by-\pgfsvgextraborder%
  \pgf@xb=#3%
  \advance\pgf@xb by\pgfsvgextraborder%
  \pgf@yb=#4%
  \advance\pgf@yb by\pgfsvgextraborder%
  \pgf@x=\pgf@xb%
  \advance\pgf@x by-\pgf@xa%
  \pgf@y=\pgf@yb%
  \advance\pgf@y by-\pgf@ya%
  \HCode{<object data="\jobname-\the\pgf@sys@svg@picnum.svg"
    width="\the\pgf@x" height="\the\pgf@y"
  type="image/svg+xml"><p/></object>}%
  \special{t4ht>\jobname-\the\pgf@sys@svg@picnum.svg}%
  \pgfsys@invoke{<svg width="\the\pgf@x" height="\the\pgf@y" viewBox="}
  \pgf@sys@pt{\pgf@xa}\pgf@sys@pt{\pgf@ya}\pgf@sys@pt{\pgf@x}\pgf@sys@pt{\pgf@y}%
  \pgfsysprotocol@flushcurrentprotocol%
  \pgf@ya=-\pgf@ya%
  \pgfsys@invoke{"> <g transform="translate(0,\the\pgf@yb) scale(1,-1)
    translate(0,\the\pgf@ya)"
  style="stroke:none;fill:none">}
  \edef\pgf@sys@svg@savedpicnum{\the\pgf@sys@svg@picnum}%
}
\def\pgfsys@endpicture{%
  \pgfsys@invoke{</g></svg>}%
  \special{t4ht<\jobname-\pgf@sys@svg@savedpicnum.svg}%
}

\def\pgfsys@beginhbox{\HCode{<text style="fill:black" transform="scale(1,-1)">}}
\def\pgfsys@endhbox{\HCode{</text>}}

\endinput


%%% Local Variables: 
%%% mode: latex
%%% End: 
