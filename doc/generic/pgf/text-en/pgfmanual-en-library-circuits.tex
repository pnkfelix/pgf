% Copyright 2008 by Massimo Redaelli, Till Tantau and Mark Wibrow 
%
% This file may be distributed and/or modified
%
% 1. under the LaTeX Project Public License and/or
% 2. under the GNU Free Documentation License.
%
% See the file doc/generic/pgf/licenses/LICENSE for more details.


\section{Circuit Libraries}
\label{section-library-circuits}

\emph{by Massimo Redaelli, Till Tantau, and Mark Wibrow}


\subsection{Overview}

The circuit libraries can be used to draw different kinds of
electrical or logical circuits. There is not a single library for
this, but a whole hierarchy of libraries that work in concert. The
main design goal was to create a balance between easy-of-use and
easy-of-extending, while creating high-quality graphical
representations of circuits. Here is a first example:

\begin{codeexample}[]
\begin{tikzpicture}[circuit ee IEC,x=3cm,y=2cm,semithick,
                    every info/.style={font=\footnotesize},
                    small circuit symbols,
                    resistor graphic=var resistor IEC graphic,
                    diode graphic=var diode IEC graphic,
                    make contact graphic= var make contact IEC graphic]
  % Let us start with some links:
  \foreach \link/\y in {1/1,2/2,3/3.5,4/4.5,5/5.5}
  {
    \node [link] (left link \link) at (0,\y) {};
    \node [link] (right link \link) at (1,\y) {};
  }
  \draw (right link 1) -- (right link 2) -- (right link 3)
     -- (right link 4) -- (right link 5);
  
  \draw (left link 1) to [diode] ++(down:1)
                      to [voltage source={near start,volt=3,direction info},
                          resistor={near end,ohm=3}] ++(right:1)
                      to (right link 1);
  \draw (left link 1) to [resistor={ohm=4}] (right link 1);
  \draw (left link 1) to [resistor={ohm=3}] (left link 2);
  \draw (left link 2) to [voltage source={near start,volt=8,direction info=<-},
                          resistor={ohm=2,near end}] (right link 2);
  \draw (left link 2) to [resistor={near start,ohm=1},
                          make contact={near end}] (left link 3);
  \draw (left link 3) to [direction'={near start,info=$\iota$},
                          resistor={near end,info={$R=4\Omega$}}]
                            (right link 3);
  \draw (left link 4) to [voltage source={near start,volt=8,direction info=<-},
                          resistor={ohm=2,near end}] (right link 4);
  \draw (left link 3) to [resistor={ohm=1}] (left link 4);
  \draw (left link 4) to [resistor={ohm=3}] (left link 5);
  \draw (left link 5) to [resistor={ohm=4}] (right link 5);
  \draw (left link 5) to [diode] ++(up:1)
                      to [voltage source={near start,volt=3,direction info},
                          resistor={near end,ohm=3}] ++(right:1)
                      to (right link 5);
\end{tikzpicture}
\end{codeexample}

An important feature of the circuit library is that the appearance of
a circuit can be configured in general ways and that the labels are
placed automatically by default. Here is the graphic once more,
generated from \emph{exactly the same source code}, with only
the options of the |{tikzpicture}| environment replaced by
|[rotate=-90,circuit ee IEC,x=3.25cm,y=2.25cm,direction arrow=angle 60]|:

\begin{tikzpicture}[rotate=-90,circuit ee IEC,x=3cm,y=2.25cm,direction arrow=angle 60]
  % Let us start with some links:
  \foreach \link/\y in {1/1,2/2,3/3.5,4/4.5,5/5.5}
  {
    \node [link] (left link \link) at (0,\y) {};
    \node [link] (right link \link) at (1,\y) {};
  }
  \draw (right link 1) -- (right link 2) -- (right link 3)
     -- (right link 4) -- (right link 5);
  
  \draw (left link 1) to [diode] ++(down:1)
                      to [voltage source={near start,volt=3,direction info},
                          resistor={near end,ohm=3}] ++(right:1)
                      to (right link 1);
  \draw (left link 1) to [resistor={ohm=4}] (right link 1);
  \draw (left link 1) to [resistor={ohm=3}] (left link 2);
  \draw (left link 2) to [voltage source={near start,volt=8,direction info=<-},
                          resistor={ohm=2,near end}] (right link 2);
  \draw (left link 2) to [resistor={near start,ohm=1},
                          make contact={near end}] (left link 3);
  \draw (left link 3) to [direction'={near start,info=$\iota$},
                          resistor={near end,info={$R=4\Omega$}}]
                            (right link 3);
  \draw (left link 4) to [voltage source={near start,volt=8,direction info=<-},
                          resistor={ohm=2,near end}] (right link 4);
  \draw (left link 3) to [resistor={ohm=1}] (left link 4);
  \draw (left link 4) to [resistor={ohm=3}] (left link 5);
  \draw (left link 5) to [resistor={ohm=4}] (right link 5);
  \draw (left link 5) to [diode] ++(up:1)
                      to [voltage source={near start,volt=3,direction info},
                          resistor={near end,ohm=3}] ++(right:1)
                      to (right link 5);
\end{tikzpicture}

A circuit typically consists of numerous electronic elements lke
logical gates or resistors or diodes that are connected by wires. In
\pgfname/\tikzname, we use nodes for the 
electronic elements and normal lines for the wires. \tikzname\ offers
a large number of different ways of positioning and connecting nodes
in general, all of which can be used here. Additionally, the
|circuits| library defines an additional useful |to|-path that is
particularly useful for elements like a resistor on a line.

There are many different names that are used to refer to electrical
``elements,'' so a bit of terminology standardization is useful: We
will call such elements \emph{symbols}. A \emph{symbol shape} is a
\pgfname\ shape declared using the |\pgfdeclareshape| command. A
\emph{symbol node} is a node whose shape is a symbol shape.

Symbols can be created by 
|\node[shape=some symbol shape]|. However, in order to represent some
symbols correctly, just using standard \pgfname\ shapes is not
sufficient. For instance, most symbols have a visually appealing
``default size,'' but the size of a symbol shape depends only on the
current values of parameters like |minimum height| or |inner xsep|.

For these reasons, the circuit libraries introduce the concept of a
\emph{symbol graphic}. This is a style that causes a |\node| to
not only have the correct shape, but also the correct size and the
correct path usage. More generally, this style may setup things in any
way so that the ``symbol looks correct''. When you write, for
instance, |\node[diode]|, then the style called |diode graphic| is
used, which in turn is set to something like
|shape=diode IEC,draw,minimum height=...|.

Here is an overview of the different kinds of circuit libraries:

\begin{itemize}
\item The \tikzname-library |circuits| defines general keys for
  creating circuits. Mostly, these keys are useful for defining more
  specialized libraries.

  You normally do not use this library directly since it does not
  define any symbol graphics.
\item The \tikzname-library |circuits.logic| defines keys for creating
  logical gates like and-gates or xor-gates. However, this library
  also does not actually define any symbol graphics; this is done by
  two sublibraries:
  \begin{itemize}
  \item The library |circuits.logic.US| defines symbol graphics that
    cause the logical gates to be rendered in the ``US-style.'' It
    includes all of the above libraries and you can use this library
    directly.
  \item The library |circuits.logic.IEC| also defines symbol graphics
    for logical gates, but it uses rectangular gates rather that the
    round US-gates. This library can coexist peacefully with the above
    library, you can change which symbol graphics are used ``on the
    fly.'' 
  \end{itemize}
\item The \tikzname-library |cirucits.ee| defines keys for symbols
  from electrical engineering like resistors or capacitors. Again,
  sublibraries define the actual symbol graphics.
  \begin{itemize}
  \item The library |circuits.ee.IEC| defines symbol shapes that
    follow the IEC norm.
  \end{itemize}
\item The \pgfname-libraries |shapes.gates.*| define (circuit) symbol
  shapes. However, you normally do not use these shapes directly,
  rather you use a style that uses an appropriate symbol graphic,
  which in turn uses one of these shapes.
\end{itemize}

Let us have a look at a simple example. Suppose we wish to create a
logical circuit. Then we first have to decide which symbol graphics we
would like to use. Suppose we wish to use the US-style, then we would
include the library |circuits.logic.US|. If you wish to use IEC-style
symbols, use |circuits.logic.IEC|. If you cannot decide, include both:
\begin{codeexample}[code only]
\usetikzlibrary{circuits.logic.US,circuits.logic.IEC}
\end{codeexample}
To create a picture that contains a US-style circuit you can now use
the option |circuit logic US|. This will setup keys like |and gate| to
create use an appropriate symbol graphic for rendering an and
gate. Using the |circuit logic IEC| instead will setup |and gate| to
use another symbol graphic.

\begin{codeexample}[]
\begin{tikzpicture}[circuit logic US]
  \matrix[column sep=7mm]
  {
    \node (i0) {0}; &                            & \\
                    & \node [and gate] (a1) {};  & \\
    \node (i1) {0}; &                            & \node [or gate] (o) {};\\
                    & \node [nand gate] (a2) {}; & \\
    \node (i2) {1}; &                            & \\
  };
  \draw (i0.east) -- ++(right:3mm) |- (a1.input 1);
  \draw (i1.east) -- ++(right:3mm) |- (a1.input 2);
  \draw (i1.east) -- ++(right:3mm) |- (a2.input 1);
  \draw (i2.east) -- ++(right:3mm) |- (a2.input 2);
  \draw (a1.output) -- ++(right:3mm) |- (o.input 1);
  \draw (a2.output) -- ++(right:3mm) |- (o.input 2);
  \draw (o.output) -- ++(right:3mm);
\end{tikzpicture}
\end{codeexample}


\begin{codeexample}[]
\begin{tikzpicture}[circuit logic IEC]
  \matrix[column sep=7mm]
  {
    \node (i0) {0}; &                            & \\
                    & \node [and gate] (a1) {};  & \\
    \node (i1) {0}; &                            & \node [or gate] (o) {};\\
                    & \node [nand gate] (a2) {}; & \\
    \node (i2) {1}; &                            & \\
  };
  \draw (i0.east) -- ++(right:3mm) |- (a1.input 1);
  \draw (i1.east) -- ++(right:3mm) |- (a1.input 2);
  \draw (i1.east) -- ++(right:3mm) |- (a2.input 1);
  \draw (i2.east) -- ++(right:3mm) |- (a2.input 2);
  \draw (a1.output) -- ++(right:3mm) |- (o.input 1);
  \draw (a2.output) -- ++(right:3mm) |- (o.input 2);
  \draw (o.output) -- ++(right:3mm);
\end{tikzpicture}
\end{codeexample}




\subsection{The Base Circuit Library}

\begin{tikzlibrary}{circuits}
  This library is a base library that is included by other circuit
  libraries. You do not include it directly, but you will typically
  use some of the general keys, described below.
\end{tikzlibrary}

\begin{key}{/tikz/circuits}
  This key should be passed as an option to a picture or a scope that
  contains a circuit. It will do some internal setups. This key is
  normally called by more specialized keys like |circuit ee IEC|.
\end{key}




\subsubsection{Symbol Size}

\begin{key}{/tikz/circuit symbol unit=\meta{dimension} (initially 7pt)}
  This dimension is a ``unit'' for the size of symbols. The libraries
  generally define the sizes of symbols relative to this
  dimension. For instance, the longer side of an inductor is, by
  default, in the IEC library equal to five times this
  \meta{dimension}. When you change this \meta{dimension}, the size of
  all symbols will automatically change accordingly.

  Note, that it is still possible to overwrite the size of any
  particular symbol. These settings apply only to the default sizes.

\begin{codeexample}[]
\begin{tikzpicture}[circuit ee IEC]
  \draw (0,1) to [resistor] (3.5,1);
  \draw[circuit symbol unit=14pt]
        (0,0) to [resistor] (3.5,0);
\end{tikzpicture}
\end{codeexample}
\end{key}

\begin{stylekey}{/tikz/huge circuit symbols}
  This style sets the default circuit symbol unit to |10pt|.
\end{stylekey}
\begin{stylekey}{/tikz/large circuit symbols}
  This style sets the default circuit symbol unit to |8pt|.
\end{stylekey}
\begin{stylekey}{/tikz/medium circuit symbols}
  This style sets the default circuit symbol unit to |7pt|.
\end{stylekey}
\begin{stylekey}{/tikz/small circuit symbols}
  This style sets the default circuit symbol unit to |6pt|.
\end{stylekey}
\begin{stylekey}{/tikz/tiny circuit symbols}
  This style sets the default circuit symbol unit to |5pt|.
\end{stylekey}

\begin{key}{/tikz/circuit symbol size=|width| \meta{width} |height|
    \meta{height}} 
  This key sets |minimum height| to \meta{height} times the current
  value of the circuit symbol unit and the |minimum width| to
  \meta{width} times this value. Thus, this option can be used with a
  node command to set the size of the node as a multiple of the
  circuit symbol unit.
  
\begin{codeexample}[]
\begin{tikzpicture}[circuit ee IEC]
  \draw (0,1) to [resistor] (2,1) to[inductor] (4,1);

  \begin{scope}
    [every resistor/.style={circuit symbol size=width 3 height 1}]
    \draw (0,0) to [resistor] (2,0) to[inductor] (4,0);
  \end{scope}
\end{tikzpicture}
\end{codeexample}
\end{key}



\subsubsection{Declaring New Symbols}


\begin{key}{/tikz/circuit declare symbol=\meta{name}}
  This key is used to declare a symbol. It does not cause this symbol
  to be shown nor does it set a graphic to be used for the symbol, it
  simply ``prepares'' several keys that can later be used to draw a
  symbol and to configure it.

  In detail, the first key that is defined is just called
  \meta{name}. This key should be given as an option to a |node| or on
  a |to| path, as explained below. The key will take options, which
  can be used to influence the way the symbol graphic is rendered.

  Let us have a look at an example. Suppose we want to define a symbol
  called |foo|, which just looks like a simple rectangle. We could
  then say
\begin{codeexample}[code only]
\tikzset{circuit declare symbol=foo}
\end{codeexample}
  The symbol could now be used like this:
\begin{codeexample}[code only]
  \node [foo]       at (1,1) {};
  \node [foo={red}] at (2,1) {};
\end{codeexample}

  However, in the above example we would not actually see anything
  since we have not yet setup the graphic to be used by |foo|. For
  this, we must use a key called |foo graphic| or, generally,
  \meta{name}| graphic|. This key gets graphic options as parameter
  that will be set when a symbol |foo| should be shown:
\begin{codeexample}[]
\begin{tikzpicture}
  [circuit declare symbol=foo,
   foo graphic={draw,shape=rectangle,minimum size=5mm}]

  \node [foo]       at (1,1) {};
  \node [foo={red}] at (2,1) {};
\end{tikzpicture}
\end{codeexample}

  In detail, when you use the key \meta{name}=\meta{options} with a
  node, the following happens:
  \begin{enumerate}
  \item The |inner sep| is set to |0.5pt|.
  \item The following style is executed:
    \begin{stylekey}{/tikz/every circuit symbol}
      Use this style to setup things in general.
    \end{stylekey}
  \item The graphic options that have been set using
    \meta{name}| graphic| are set.
  \item The style |every |\meta{name} is executed. You can use it to
    configure the symbol further.
  \item The \meta{options} are executed.
  \end{enumerate}

  The key \meta{name} will have a different effect when it is used on
  a |to| path command inside a |circuit| environment (the |circuit|
  environment sets up |to| paths in such a way that the use of a key
  declared using |circuit declare symbol| is automatically detected).
  When \meta{name} is used on a |to| path, the above actions also
  happen (setting the inner seperation, using the symbol graphic, and
  so on), but they are passed to the key |circuit handle symbol|,
  which is explained next.
\end{key}


\begin{key}{/tikz/circuit handle symbol=\meta{options}}
  This key is mostly used internally. Its purpose is to render a
  symbol. The effect of this key differs, depending on whether it is
  used as the optional argument of a |to| path command or elsewhere.

  If the key is not used as an argument of a |to| path command, the
  \meta{options} are simply executed.

  The more interesting case happens when the key is given on a |to|
  path command. In this case, several things happen:
  \begin{enumerate}
  \item The |to| path is locally changed and set to an internal 
    path (which you should not try to change) that consists mostly of
    a single straight line.
  \item The \meta{options} are tentatively executed with filtering
    switched on. Everything is filtered out, except for the key |pos|
    and also the styles |at start|, |very near start|, |near start|,
    |midway|, |near end|, |very near end|, and |at end|. If none of
    them is found, |midway| is used.
  \item The filtered option is used to determine a position for the
    symbol on the path. At the given position (with |pos=0|
    representing the start and |pos=1| representing the end), a node
    will be added to the path (in a manner to be described presently).
  \item This node gets \meta{options} as its option list.
  \item The node is added by virtue of a special |markings|
    decoration. This means that a |mark| command is executed that
    causes the node to placed as a mark on the path.
  \item The marking decoration will automatically subdivide the path
    and cause a line to be drawn to from the start of the path to the
    node's border (at the position that lies on a line from the node's
    center to the start of the path) and then from the node's border
    (at a position on the other side of the node) to the end of the
    path.
  \item The marking decoration will also take care of the case that
    multiple marks are present on a path, in this case the lines from
    and to the borders of the nodes are only between consecutive
    nodes.
  \item The marking decoration will also rotate the coordinate system
    in such a way that the $x$-axis points along the path. Thus, if
    you use the |transform shape| option, the node will ``point
    along'' the path.
  \item In case a node is at |pos=0| or at |pos=1| some special code
    will suppress the superfluous lines to the start or end of the
    path. 
  \end{enumerate}

  The net effect of all of the above is that a node will be placed
  ``on the path'' and the path will have a ``gap'' just large enough
  to encompass the node. Another effect is that you can use this key
  multiple times on a path to add several node to a path, provided
  they do not overlap.
\begin{codeexample}[]
\begin{tikzpicture}[circuit]
  \draw (0,0) to [circuit handle symbol={draw,shape=rectangle,near start},
                  circuit handle symbol={draw,shape=circle,near end}] (3,2);
  \end{tikzpicture}
\end{codeexample}
\begin{codeexample}[]
\begin{tikzpicture}[transform shape,circuit]
  \draw (0,0) to [circuit handle symbol={draw,shape=rectangle,at start},
                  circuit handle symbol={draw,shape=circle,near end}] (3,2);
\end{tikzpicture}
\end{codeexample}
\end{key}



\subsubsection{Pointing Symbols in the Right Direction}

Unlike normal nodes, which generally should not be rotated since this
will make their text hard to read, symbols often need to be
rotated. There are two ways of achieving such rotations:

\begin{enumerate}
\item When you place a symbol on a |to| path, the graphic symbol is
  automatically rotated such that it ``points along the path.'' Here
  is an examples that show how the inductor shape (which looks,
  unrotated, like this: \tikz[circuit ee IEC]\node[inductor]{};) is
  automatically rotated around:
\begin{codeexample}[]
\tikz [circuit ee IEC]
  \draw (3,0) to[inductor] (1,0) to[inductor] (0,2);
\end{codeexample}
\item Many shapes cannot be placed ``on'' a path in this way, namely
  whenever there are more than two possible inputs. Also, you may wish
  to place the nodes first, possibly using a matrix, and connect them
  afterwards. In this case, you can simply add rotations like
  |rotate=90| to the shapes to rotate them. The following four keys
  make this slightly more convenient:
  \begin{key}{/tikz/point up}
    This is the same as |rotate=90|.
\begin{codeexample}[]
\tikz [circuit ee IEC] \node [diode,point up] {};
\end{codeexample}    
  \end{key}
  \begin{key}{/tikz/point down}
    This is the same as |rotate=-90|.
\begin{codeexample}[]
\tikz [circuit ee IEC] \node [diode,point down] {};
\end{codeexample}    
  \end{key}
  \begin{key}{/tikz/point left}
    This is the same as |rotate=-180|.
\begin{codeexample}[]
\tikz [circuit ee IEC] \node [diode,point left] {};
\end{codeexample}    
  \end{key}
  \begin{key}{/tikz/point right}
    This key has no effect.
\begin{codeexample}[]
\tikz [circuit ee IEC] \node [diode,point right] {};
\end{codeexample}    
  \end{key}
\end{enumerate}


\subsubsection{Info Labels}

Info labels are used to add text to a circuit symbol. Unlike normal
nodes like a rectangle, circuit symbols typically do not have text
``on'' them, but the text is placed next to them (like the text
``$3\Omega$'' next to a resistor).

\tikzname\ already provides the |label| option for this purpose. The
|info| option is build on top of this option, but it comes in some
predefined variants that are especially useful in conjunction with
circuits.

\begin{key}{/tikz/info=\opt{|[|\meta{options}|]|\meta{angle}|:|}\meta{text}}
  This key has nearly the same effect as the |label| key, only the
  following style is used additionally automatically:
  \begin{stylekey}{/tikz/every info}
    Set this style to configure the styling of info labels. Since this
    key is \emph{not} used with normal labels, it provides an easy way
    of changing the way info labels look without changing other
    labels. 
  \end{stylekey}
  The \meta{options} and \meta{angle} are passed directly to the
  |label| command.
\begin{codeexample}[]
\begin{tikzpicture}[circuit ee IEC,every info/.style=red]
  \node [resistor,info=$3\Omega$] {};
\end{tikzpicture}
\end{codeexample}

  You will find a detailed discussion of the |label| option on
  page~\pageref{label-option}.

  Hint: To place some text \emph{on} the main node, use |center| as
  the \meta{angle}:
\begin{codeexample}[]
\begin{tikzpicture}[circuit ee IEC,every info/.style=red]
  \node [resistor,info=center:$3\Omega$] {};
  \node [resistor,point up,info=center:$R_1$] at (2,0) {};
\end{tikzpicture}
\end{codeexample}
\end{key}

\begin{key}{/tikz/info'=\opt{|[|\meta{options}|]|\meta{angle}|:|}\meta{text}}
  This key works exactly like the |info| key, only in case the
  \meta{angle} is missing, it defaults to |below| instead of the
  current value of  |label position|, which is usually |above|. This
  means that when you use |info|, you get a label above the node,
  while when you use the |info'| key you get a label below the
  node. In case the node has been rotated, the positions of the info
  nodes are rotated accordingly.
\begin{codeexample}[]
\begin{tikzpicture}[circuit ee IEC,every info/.style=red]
  \draw (0,0) to[resistor={info={$3\Omega$},info'={$R_1$}}] (3,0)
              to[resistor={info={$4\Omega$},info'={$R_2$}}] (3,2);
\end{tikzpicture}
\end{codeexample}
\end{key}

\begin{key}{/tikz/info sloped=\opt{|[|\meta{options}|]|\meta{angle}|:|}\meta{text}}
  This key works like |info|, only the |transform shape| option is set
  when the label is drawn, causing it to follow the sloping of the
  main node. 
\begin{codeexample}[]
\begin{tikzpicture}[circuit ee IEC,every info/.style=red]
  \draw (0,0) to[resistor={info sloped={$3\Omega$}}] (3,0)
              to[resistor={info sloped={$4\Omega$}}] (3,2);
\end{tikzpicture}
\end{codeexample}
\end{key}

\begin{key}{/tikz/info' sloped=}
  This is a combination of |info'| and |info sloped|.
\begin{codeexample}[]
\begin{tikzpicture}[circuit ee IEC,every info/.style=red]
  \draw (0,0) to[resistor={info' sloped={$3\Omega$}}] (3,0)
              to[resistor={info' sloped={$4\Omega$}}] (3,2);
\end{tikzpicture}
\end{codeexample}
\end{key}

\begin{key}{/tikz/circuit declare unit=\marg{name}\marg{unit}}
  This key is used to declare keys that make it easy to attach
  physical units to nodes. The idea is that instead of
  |info=$3\Omega$| you can write |ohm=3| or instead of
  |info'=$5\mathrm{S}$| you can write |siemens'=5|.

  In detail, four keys are defined, namely |/tikz/|\meta{name},
  |/tikz/|\meta{name}|'|, |/tikz/|\meta{name} |sloped|, and
  |/tikz/|\meta{name}|'| |sloped|. The arguments of all of these keys
  are of the form
  \opt{|[|\meta{options}|]|\meta{angle}|:|}\meta{value} and it is
  passed (slightly modified) to the corresponding key |info|, |info'|,
  |info| |sloped|, or |info'| |sloped|. The ``slight modification'' is the
  following: The text that is passed to the, say, |info| key is not
  \meta{value}, but rather |$\mathrm{|\meta{value}\meta{unit}|}$|
  
  This means that after you said |circuit declare unit={ohm}{\Omega}|,
  then |ohm=5k| will have the same effect as
  |info={[every ohm]$\mathrm{5k\Omega}$}|. Here, |every ohm| is a
  style that allows you to configure the appearance of this unit.   
  Since the |info| key is used internally, by changing the
  |every info| style, you can change the appearance of all units
  infos.
\begin{codeexample}[]
\begin{tikzpicture}[circuit ee IEC,circuit declare unit={my ohm}{O}]
  \draw (0,0) to[resistor={my ohm' sloped=3}] (3,2);
\end{tikzpicture}
\end{codeexample}
\end{key}


\subsubsection{Theming Symbols}
\label{section-theming-symbols}
For each symbol, a certain graphical representation is chosen to
actually show the symbol. You can modify this graphical representation
in several ways:

\begin{itemize}
\item You can select a different library and use a different
  |circuit ...| key. This will change all graphics used for the
  symbols.
\item You can generally change the size of graphic symbols by setting
  |circuit size unit| to a different value or using a key like
  |small circuit symbols|.
\item
  You can add options to the graphics used by symbols either globally
  by settings the |every circuit symbol| style or locally by setting the
  |every| \meta{name} style, where \meta{name} is the name of a
  symbol. For instance, in the following picture the symbols are
  ridiculously thick and resistors are red.
\begin{codeexample}[]
\begin{tikzpicture}
  [circuit ee IEC,
   every symbol/.style={ultra thick},
   every resistor/.style={red}]

  \draw (0,0) to [inductor] ++(right:3) to [resistor] ++(up:2);
\end{tikzpicture}
\end{codeexample}
\item You can selectively change the graphic used for a symbol like a
  resistor by saying |resistor graphic=...|.
\item You can change one or more of the following styles:
  \begin{stylekey}{/tikz/circuit symbol open (initially draw)}
    This style is used with symbols that consist of lines that
    surround some area. For instance, the IEC version of a resistor is
    an open symbol. 
\begin{codeexample}[]
\tikz [circuit ee IEC,
       circuit symbol open/.style={thick,draw,fill=yellow}]
  \draw (0,0) to [inductor] ++(right:3) to [resistor] ++(up:2);
\end{codeexample}
  \end{stylekey}
  \begin{stylekey}{/tikz/circuit symbol filled (initially {draw,fill=black})}
    This style is used with symbols that are completely filled. For
    instance, the variant IEC version of an inductor is a filled,
    black rectangle. 
  \end{stylekey}
  \begin{stylekey}{/tikz/circuit symbol lines (initially draw)}
    This style is used with symbols that consist only of lines the do
    not surround anything. Examples are a capacitor.
\begin{codeexample}[]
\tikz [circuit ee IEC,
       circuit symbol lines/.style={thick,draw=red}]
  \draw (0,0) to [capacitor] ++(right:3) to [resistor] ++(up:2);
\end{codeexample}
  \end{stylekey}
  \begin{stylekey}{/tikz/circuit symbol lines (initially draw)}
    This style is used for symbols that consist only of ``wires.'' The
    difference to the previous style is that a symbol consisting of
    wires will look strange when the lines are thicker than the lines
    of normal wires, while for symbols consisting of lines (but not
    wires) it may look nice to make them thicker. An example is the
    |make contact| symbol.

    Compare 
\begin{codeexample}[]
\tikz [circuit ee IEC,circuit symbol lines/.style={draw,very thick}]
  \draw (0,0) to [capacitor={near start},
                  make contact={near end}] (3,0);
\end{codeexample}
    to 
\begin{codeexample}[]
\tikz [circuit ee IEC,circuit symbol wires/.style={draw,very thick}]
  \draw (0,0) to [capacitor={near start},
                  make contact={near end}] (3,0);
\end{codeexample}
  \end{stylekey}
\end{itemize}

All circuit environments like |circuit logic IEC| mainly use options
like |and gate graphic=...| to setup the graphics used for a certain
symbol. It turns out that graphic hidden in the ``|...|'' part is also
always available as a separate style, whose name contains the
library's initials. For instance, the |circuit logic IEC| option
actually contains the following command:
\begin{codeexample}[code only]
  and gate graphic = and gate IEC graphic,
\end{codeexample}
The |and gate IEC graphic| style, in turn, is defined as follows:
\begin{codeexample}[code only]
\tikzset{and gate IEC graphic/.style=
  {
    circuit symbol open,
    circuit symbol size=width 2.5 height 4,
    shape=and gate IEC,
    inner sep=.5ex
  }
}
\end{codeexample}

Normally, you do not need to worry about this, since you will not need
to access a style like |and gate IEC graphic| directly; you will only
use the |and gate| key. However, sometimes libraries define
\emph{variants} of a graphic; for instance, there are two variants for
the resistor graphic in the IEC library. In this case you can set the
graphic for the resistor to this variant (or back to the original) by
setting the |resistor graphic| yourself:

\begin{codeexample}[]
\begin{tikzpicture}[circuit ee IEC]
  % Standard resistor
  \draw (0,2) to [resistor] (3,2);

  % Var resistor
  \begin{scope}[resistor graphic=var resistor IEC graphic]
    \draw (0,1) to [resistor] (3,1);

    % Back to original
    \draw [resistor graphic=resistor IEC graphic]
      (0,0) to [resistor] (3,0);
  \end{scope}
\end{tikzpicture}
\end{codeexample}



\subsection{Logical Circuits}

A \emph{logical circuit} is a circuit that contains what we call
\emph{logical gates} like an and-gate or an xor-gate. The logical
libraries are intended to make it easy to draw such circuits.

In the following, we first have a look at the different libraries that
can be used in principle and how the symbols look like. Then we have a
more detailed look at how the symbols are used. Finally, we discuss
the implementation details.


\subsubsection{The Different Libraries}

There are different ways of drawing these gates, which is why there
are different (sub-)libraries for drawing them. They provide the necessary
graphical representations of the symbols declared in the following
library: 

\begin{tikzlibrary}{circuits.logic}
  This library declares the logical gate symbols, but does not 
  provide the symbol graphics.
  The library also defines the following key which, however, is also
  only used indirectly, namely by other libraries:
  \begin{key}{/tikz/circuit logic}
    This style calls the keys |circuit| (which internally calls
    |every circuit|, then it defines the |inputs| key and it calls the
    |every circuit logic| key.
    \begin{key}{/tikz/inputs=\meta{inputs}}
      This key is defined only inside the scope of a
      |circuit logic|. There, it has the same effect as
      |logic gate inputs|, described on
      page~\pageref{logic-gates-inputs}. 
    \end{key}
    \begin{stylekey}{/tikz/every circuit logic}
      Use this key to configure the appearance of logical circuits.      
    \end{stylekey}
  \end{key}
\end{tikzlibrary}

Since the |circuit.logic| library does not define any actual graphics,
you need to use one of the following libraries, instead:

\begin{pgflibrary}{circuits.logic.IEC}
  This library provides graphics based on gates
  recommended by the International Electrotechincal Commission.  When
  you include this library, you can use the |circuit logic IEC| key to
  setup a scope that contains a logical circuit where the gates are 
  shown in this style.
\end{pgflibrary}

\begin{pgflibrary}{circuits.logic.US}
  This library provides graphics showing ``American'' logic
  gates.
\end{pgflibrary}

\begin{pgflibrary}{circuits.logic.CDH}
  This library provides graphics based on the logic symbols used in
  A. Croft, R. Davidson, and M. Hargreaves (1992),  \emph{Engineering
    Mathematics}, Addison-Wesley, 82--95. They are identical to the
  US-style symbols, except for the and- and nand-gates.
\end{pgflibrary}


\subsubsection{The Different Symbols}

\label{section-logic-symbols}

The following table shows which symbols are declared by the main
|circuits.logic| library and their appearance in the different
sublibraries.
\medskip

\def\gateexamples#1{%
  \indexkey{#1}
  \texttt{#1} &
  \tikz[baseline,circuit logic IEC] \node[#1,label=] {}; &
  \tikz[baseline,circuit logic US]  \node[#1] {}; &
  \tikz[baseline,circuit logic CDH] \node[#1] {}; 
}
\begin{tabular}{lccc}
  Key & Appearance inside & Appearance inside & Appearance inside \\
      & |circuit logic IEC| & |circuit logic US| & |circuit logic CDH| \\
  \gateexamples{/tikz/and gate}\\
  \gateexamples{/tikz/nand gate}\\
  \gateexamples{/tikz/or gate}\\
  \gateexamples{/tikz/nor gate}\\
  \gateexamples{/tikz/xor gate}\\
  \gateexamples{/tikz/xnor gate}\\
  \gateexamples{/tikz/not gate}\\
  \gateexamples{/tikz/buffer gate}
\end{tabular}




\subsubsection{Usage}

To draw a logical circuit, the first step is to include one of the
logical circuit libraries, say, |circuits.logic.IEC|. Then, inside a
\tikzname\ picture you use one of the following styles:

\begin{key}{/tikz/circuit logic IEC}
  This style calls |circuit logic| and installs the IEC-like
  graphics for the logical symbols like |and gate|.
\end{key}
\begin{key}{/tikz/circuit logic US}
  This style calls |circuit logic| and installs US-like graphics 
  for the logical symbols like |and gate|.
\end{key}
\begin{key}{/tikz/circuit logic CDH}
  This style calls |circuit logic US| and installs the two special
  and- and nand-gates.
\end{key}

Inside these scopes, you can now use the keys shown in
Section~\ref{section-logic-symbols}. We have a more detailed look at
one of them, all the other work the same way:

\begin{key}{/tikz/and gate}
  This key should be passed to a |node| command. It will cause the
  node to ``look like'' an and-gate, where the exact appearance of the
  gate is dictated by the which circuit environment is used.   To
  further configure the appearance of the |and gate|, see 
  Section~\ref{section-theming-symbols}.

\begin{codeexample}[]
\tikz [circuit logic IEC] \node [and gate] {$A$};    
\end{codeexample}
\begin{codeexample}[]
\tikz [circuit logic US]
{
  \node [and gate,point down] {$A$};
  \node [and gate,point down,info=center:$A$] at (1,0) {};
}
\end{codeexample}

  \medskip\textbf{Inputs.}
  Multiple inputs can be specified for a logic gate (provided they
  support multiple inputs: a not gate---also known as an
  inverter---does not). However, there is an upper limit for the
  number of inputs which has been set at 1024, which should be \emph{way} 
  more than would ever be needed.

  The following key is used to configure the inputs. It is available
  only inside a |circuit logic| environment.
 
  \begin{key}{/tikz/inputs=\meta{input list} (initially \char`\{normal,normal\char`\})}
    If a gate has $n$ inputs, the \meta{input list} should consists of
    $n$ letters, each being |i| for ``inverted'' or |n| for
    ``normal.'' Inverted gates will be indicated by a little
    circle. In any case the anchors for the inputs will be set  
    up appropriately, numbered from top to bottom |input 1|, |input 2|,
    \ldots and so on. If the gate only supports one input the anchor
    is simply called |input| with no numerical index.
\begin{codeexample}[]
\begin{tikzpicture}[circuit logic IEC]
  \node[and gate,inputs={inini}] (A) {};
  \foreach \a in {1,...,5}
    \draw (A.input \a -| -1,0) -- (A.input \a);
  \draw (A.output) -- ++(right:5mm);
\end{tikzpicture}
\end{codeexample} 
  \end{key}

  (This key is just a shorthand for |logic gate inputs|, described
  in detail on page~\pageref{logic-gate-inputs}. There you will also
  find descriptions of how to configure the size of the inverted
  circles and the way the symbol size increases when there are too
  many inputs.)
  
  \textbf{Output.}
  Every logic gate has one anchor called |output|.
\end{key}




\subsubsection{IEC-Style Symbol Graphics}

As explained earlier, the library |circuits.logic.IEC| defines the
style |circuit logic IEC|, which installs graphics for the
logical symbols that follow the guidelines of the International
Electrotechincal Commission.

Normally, all you need to do to use this library is to add
|circuit logic IEC| to some scope. This will cause, for instance, that
|and gate graphic| is set to a graphic for the and gate.

As explained in Section~\ref{section-theming-symbols}, for each
graphic symbol of the library there is also a style that stores this
particular appearance. These keys are called |and gate IEC graphic|,
|or gate IEC graphic|, and so on.


\begin{codeexample}[]
\begin{tikzpicture}[circuit logic IEC,
                    every circuit symbol/.style={
                      logic gate IEC symbol color=black,
                      fill=blue!20,draw=blue,very thick}]
  \matrix[column sep=7mm]
  {
    \node (i0) {0}; &                            & \\
                    & \node [and gate] (a1) {};  & \\
    \node (i1) {0}; &                            & \node [or gate] (o) {};\\
                    & \node [nand gate] (a2) {}; & \\
    \node (i2) {1}; &                            & \\
  };
  \draw (i0.east) -- ++(right:3mm) |- (a1.input 1);
  \draw (i1.east) -- ++(right:3mm) |- (a1.input 2);
  \draw (i1.east) -- ++(right:3mm) |- (a2.input 1);
  \draw (i2.east) -- ++(right:3mm) |- (a2.input 2);
  \draw (a1.output) -- ++(right:3mm) |- (o.input 1);
  \draw (a2.output) -- ++(right:3mm) |- (o.input 2);
  \draw (o.output) -- ++(right:3mm);
\end{tikzpicture}
\end{codeexample}


\subsubsection{US-Style Symbol Graphics}

Both the |circuits.logic.US| and |circuits.logic.CDH| setup
environments for using US-style graphics as logical gate graphics.

The US-library defines graphic styles called |and gate US graphic| and
so on for each logical gate graphic. The CDH-library includes the
US-library and only defines two additional variant graphics:
|and gate CDH graphic| and |nand gate CDH graphic|.


\begin{codeexample}[]
\begin{tikzpicture}[circuit logic CDH,
                    tiny circuit symbols,
                    every circuit symbol/.style={
                      fill=white,draw}]
  \matrix[column sep=7mm]
  {
    \node (i0) {0}; &                            & \\
                    & \node [and gate] (a1) {};  & \\
    \node (i1) {0}; &                            & \node [or gate] (o) {};\\
                    & \node [nand gate] (a2) {}; & \\
    \node (i2) {1}; &                            & \\
  };
  \draw (i0.east) -- ++(right:3mm) |- (a1.input 1);
  \draw (i1.east) -- ++(right:3mm) |- (a1.input 2);
  \draw (i1.east) -- ++(right:3mm) |- (a2.input 1);
  \draw (i2.east) -- ++(right:3mm) |- (a2.input 2);
  \draw (a1.output) -- ++(right:3mm) |- (o.input 1);
  \draw (a2.output) -- ++(right:3mm) |- (o.input 2);
  \draw (o.output) -- ++(right:3mm);
\end{tikzpicture}
\end{codeexample}


\subsubsection{Implementation: The Underlying Shape Libraries}

The previous sections described the \tikzname\ interface for creating
logical circuits. In this section we take a closer look at the
underlying \pgfname\ libraries. 

Just as there are several \tikzname\ circuit libraries, there are two
underlying \pgfname\ shape libraries, one for creating US-style gates
and one for IEC-style gates. These libraries define \emph{shapes}
only. It is the job of the circuit libraries to ``theme'' them so that
they ``look nice.'' However, in principle, you can also use these
shapes directly.

Let us begin with the base library that defines the handling of
inputs.

\begin{pgflibrary}{shapes.gates.logic}
  This library defines common keys used by all logical gate shapes.

\begin{key}{/pgf/logic gate inputs=\meta{input list} (initially \char`\{normal,normal\char`\})}
  \label{logic-gate-inputs}%
  Specify the inputs for for the logic gate. The keyword |inverted|
  indicates an inverted input which will mean \pgfname{} will draw a
  circle attached to the main shape of the logic gate. Any keyword
  that is not |inverted| will be treated as a ``normal'' or 
  ``non-inverted'' input (however, for readability, you may wish to 
  use |normal| or |non-inverted|), and \pgfname{} will not draw the 
  circle.  
  In both cases the anchors for the inputs will be set 
  up appropriately, numbered from top to bottom |input 1|, |input 2|,
  \ldots and so on. If the gate only supports one input the anchor
  is simply called |input| with no numerical index.
  
\begin{codeexample}[]
\begin{tikzpicture}[minimum height=0.75cm]
  \node[and gate IEC, draw, logic gate inputs={inverted, normal, inverted}] 
    (A) {};
  \foreach \a in {1,...,3}
    \draw (A.input \a -| -1,0) -- (A.input \a);
  \draw (A.output) -- ([xshift=0.5cm]A.output);
\end{tikzpicture}
\end{codeexample} 
  
  For multiple inputs it may be somewhat unweildy to specify a long
  list, thus, the following ``shorthand'' is permitted (this is an  
  extension of ideas due to Juergen Werber and Christoph Bartoschek):
  Using |i| for inverted and |n| for normal inputs, \meta{input list}
  can be specfied \emph{without the commas}. So, for example,
  |ini| is equivalent to |inverted, normal, inverted|.
  
\begin{codeexample}[]
\begin{tikzpicture}[minimum height=0.75cm]
  \node[or gate US, draw,logic gate inputs=inini] (A) {};
  \foreach \a in {1,...,5}
    \draw (A.input \a -| -1,0) -- (A.input \a);
  \draw (A.output) -- ([xshift=0.5cm]A.output);
\end{tikzpicture}
\end{codeexample} 
 
\end{key}

The height of the gate may be increased to accommodate the number 
of inputs. In fact, it depends on three variables:
$n$, the number of inputs, $r$, the radius of the circle used
to indicate an inverted input and $s$, the distance between
the centers of the inputs.
The default height is then calculated according to the expression 
$(n+1)\times\max(2r,s)$. This then may
be increased to accommodate the node contents or any
minimum size specifications.

The radius of the inverted input circle and the distance between the 
centers of the inputs can be customised using the following keys:

\begin{key}{/pgf/logic gate inverted radius=\meta{length} (initially 2pt)}
  Set the radius of the circle that is used to indicate inverted
  inputs. This is also the radius of the circle used for the inverted
  output of the |nand|, |nor|, |xnor| and |not| gates. 
    
\begin{codeexample}[]
\begin{tikzpicture}[minimum height=0.75cm]
  \tikzset{every node/.style={shape=nand gate CDH, draw, logic gate inputs=ii}}
  \node[logic gate inverted radius=2pt] {A};
  \node[logic gate inverted radius=4pt] at (0,-1) {B};
\end{tikzpicture}
\end{codeexample} 
\end{key}

\begin{key}{/pgf/logic gate input sep=\meta{length} (initially .125cm)}
  Set the distance between the \emph{centers} of the inputs to the
  logic gate. 
  
\begin{codeexample}[]
\begin{tikzpicture}[minimum size=0.75cm]
  \draw [help lines] grid (3,2);
  \tikzset{every node/.style={shape=and gate IEC, draw, logic gate inputs=ini}}
  \node[logic gate input sep=0.33333cm] at (1,1)(A) {A};
  \node[logic gate input sep=0.5cm]     at (3,1) (B) {B};
  \foreach \a in {1,...,3}
    \draw (A.input \a -| 0,0) -- (A.input \a)
          (B.input \a -| 2,0) -- (B.input \a);
\end{tikzpicture}
\end{codeexample} 
\end{key}
 
  \pgfname{} will increase the size of the 
  logic gate to accommodate the number of inputs, and the size
  of the inverted radius and the separation between the inputs.
  However with all shapes in this library, any increase in size 
  (including any minimum size requirements) will be applied so that 
  the default aspect ratio is unaltered. This means that changing
  the height will change the width and vice versa. 

\end{pgflibrary}

\begin{pgflibrary}{shapes.gates.logic.US}
  This library provides ``American'' logic gate shapes whose names are 
  suffixed with the identifier |US|. Additionally,
  alternative |and| and |nand| gates are provided which are based on the 
  logic symbols used in A. Croft, R. Davidson, and M. Hargreaves (1992), 
  \emph{Engineering Mathematics}, Addison-Wesley, 82--95. These two 
  shapes are suffixed with |CDH|. 

  The ``compass point'' anchors apply to the main part of the shape
  and do not include any inverted inputs or outputs. This library
  provides an additonal feature to facilitate the relative positioning
  of logic gates:

\begin{key}{/pgf/logic gate anchors use bounding box=\meta{boolean} (initially false)}
  When set to |true| this key will ensure that the 
  compass point anchors use the bounding rectangle of the
  main shape, which, ignore any inverted inputs or outputs, but
  includes any |outer sep|. 
  This \emph{only} affects the compass point anchors
  and is not set on a shape by shape basis: whether the bounding
  box is used is determined by value of this key when the anchor
  is accessed.

\begin{codeexample}[]
\begin{tikzpicture}[minimum height=1.5cm]
  \node[xnor gate US, draw, gray!50,line width=2pt] (A) {};
  \foreach \x/\y/\z in {false/blue/1pt, true/red/2pt}
    \foreach \a in {north, south, east, west, north east, 
      south east, north west, south west}
      \draw[logic gate anchors use bounding box=\x, color=\y]	
        (A.\a) circle(\z);
\end{tikzpicture}
\end{codeexample} 

\end{key}

  The library defines a number of shapes. For each shape the allowed
  number of inputs is also shown:
  \begin{itemize}
  \item |and gate US|, two or more inputs
  \item |and gate CDH|, two or more inputs
  \item |nand gate US|, two or more inputs
  \item |nand gate CDH|, two or more inputs
  \item |or gate US|, two or more inputs
  \item |nor gate US|, two or more intpus
  \item |xor gate US|, two inputs
  \item |xnor gate US|, two inputs
  \item |not gate US|, one input
  \item |buffer gate US|, one input
  \end{itemize}

  In the following, we only have a detailed look at the anchors
  defined by one of them. We choose the |nand gate US| because it
  shows all the ``interesting'' anchors.

  \begin{shape}{nand gate US}
    This shape is a nand gate, which supports two or more inputs. If
    less than two inputs are specified an error will result. 
    The anchors for this gate with two
    non-inverted inputs (using the normal compass point anchors) are
    shown below. Anchor |30| is an example of a border anchor.
 
\begin{codeexample}[]
\Huge
\begin{tikzpicture}
  \node[name=s,shape=nand gate US,shape example, inner sep=0cm,
  logic gate inputs={in},
  logic gate inverted radius=.5cm] {Nand Gate\vrule width1pt height2cm};
  \foreach \anchor/\placement in
    {center/above, text/above, 30/above right,
     mid/right, mid east/left, mid west/above,
     base/below, base east/below, base west/left,
     north/above, south/below, east/above, west/above,
     north east/above, south east/below, south west/below, north west/above,
     output/right, input 1/above, input 2/below}
     \draw[shift=(s.\anchor)] plot[mark=x] coordinates{(0,0)}
       node[\placement] {\scriptsize\texttt{(s.\anchor)}};
\end{tikzpicture}
\end{codeexample}
  \end{shape}
\end{pgflibrary}



\begin{pgflibrary}{shapes.gates.logic.IEC}
  This library provides rectangular logic gate shapes. These shapes
  are suffixed with |IEC| as they are based on gates recommended by
  the International Electrotechincal Commission.

  By default each gate is drawn with a symbol, $\char`\&$ for |and| and 
  |nand| gates, $\geq1$ for |or| and |nor| gates, $1$ for |not| and 
  |buffer| gates, and $=1$ for |xor| and |xnor| gates. These symbols 
  are drawn automatically (internally they are drawn using the 
  ``foreground'' path), and are not strictly speaking part of the node
  contents. However, the gate is enlarged to make sure the symbols are 
  within the border of the node.
  It is possible to change
  the symbols and their position within the node using the following
  keys:
  
\begin{key}{/pgf/and gate IEC symbol=\meta{text} (initially \char`\\char\char`\`\char`\\\char`\&)}
  Set the symbol for the |and gate|. Note that if the node is filled,
  this color will be used for the symbol, making it invisible, so
  it will be necessary set \meta{text} to something like
  |\color{black}\char`\&|. Alternatively, the 
  |logic gate IEC symbol color| key can be used to set the color
  of all symbols simultaneously.
  
  In \tikzname, when the |use IEC style logic gates| key has been 
  used, this key can be replaced by |and gate symbol|.
\end{key}

\begin{key}{/pgf/nand gate IEC symbol=\meta{text} (initially \char`\\char\char`\`\char`\\\char`\&)}
  Set the symbol for the |nand gate|.  
  In \tikzname, when the |use IEC style logic gates| key has been 
  used, this key can be replaced by |nand gate symbol|.
\end{key}

\begin{key}{/pgf/or gate IEC symbol=\meta{text} (initially \char`\$\char`\\geq1\char`\$)}
  Set the symbol for the |or gate|.  
  In \tikzname, when the |use IEC style logic gates| key has been 
  used, this key can be replaced by |or gate symbol|.
\end{key}

\begin{key}{/pgf/nor gate IEC symbol=\meta{text} (initially \char`\$\char`\\geq1\char`\$)}
  Set the symbol for the |nor gate|.  
  In \tikzname, when the |use IEC style logic gates| key has been 
  used, this key can be replaced by |nor gate symbol|.
\end{key}

\begin{key}{/pgf/xor gate IEC symbol=\meta{text} (initially \char`\{\char`\$=1\char`\$\char`\})}
  Set the symbol for the |xor gate|. Note the necessity for braces,
  as the symbol contains |=|.
  In \tikzname, when the |use IEC style logic gates| key has been 
  used, this key can be replaced by |or gate symbol|.
\end{key}

\begin{key}{/pgf/xnor gate IEC symbol=\meta{text} (initially  \char`\{\char`\$=1\char`\$\char`\})}
  Set the symbol for the |xnor gate|.  
  In \tikzname, when the |use IEC style logic gates| key has been 
  used, this key can be replaced by |xnor gate symbol|.
\end{key}

\begin{key}{/pgf/not gate IEC symbol=\meta{text} (initially 1)}
  Set the symbol for the |not gate|.  
  In \tikzname, when the |use IEC style logic gates| key has been 
  used, this key can be replaced by |not gate symbol|.
\end{key}

\begin{key}{/pgf/buffer gate IEC symbol=\meta{text} (initially 1)}
  Set the symbol for the |buffer gate|.  
  In \tikzname, when the |use IEC style logic gates| key has been 
  used, this key can be replaced by |buffer gate symbol|.
\end{key}

\begin{key}{/pgf/logic gate IEC symbol align=\meta{align} (initially top)}
  Set the alignment of the logic gate symbol (in \tikzname, when the 
  |use IEC style logic gates| key has been used, |IEC| can be omitted.
  The specification in \meta{align} is a comma separated list from
  |top|, |bottom|, |left| or |right|. The distance between the border
  of the node and the outer edge of the symbol is determined by the values 
  of the |inner xsep| and |inner ysep|.
  
\begin{codeexample}[]
\begin{tikzpicture}[minimum size=1cm, use IEC style logic gates]
	\tikzset{every node/.style={nor gate, draw}}
  \node (A) at (0,1.5) {};
  \node [logic gate symbol align={bottom, right}] (B) at (0,0) {}; 
  \foreach \g in {A, B}{
    \foreach \i in {1,2}
      \draw ([xshift=-0.5cm]\g.input \i) -- (\g.input \i);
    \draw (\g.output) -- ([xshift=0.5cm]\g.output);
  }
\end{tikzpicture}
\end{codeexample} 

\end{key}


\begin{key}{/pgf/logic gate IEC symbol color=\meta{color}}
  This key sets the color for all symbols simultaneously. This color
  can be overridden on a case by case basis by specifying a color
  when seting the symbol text.
\end{key}

  The library defines the following shapes:
  \begin{itemize}
  \item |and gate IEC|, two or more inputs
  \item |nand gate IEC|, two or more inputs
  \item |or gate IEC|, two or more inputs
  \item |nor gate IEC|, two or more intpus
  \item |xor gate IEC|, two inputs
  \item |xnor gate IEC|, two inputs
  \item |not gate IEC|, one input
  \item |buffer gate IEC|, one input
  \end{itemize}

  Again, we only have a look at the nand-gate in more detail:

\begin{shape}{nand gate IEC}
  This shape is a nand gate. It supports two or more inputs.
  If less than two inputs are specified an error will result. 
	The anchors for this gate with two
  non-inverted inputs are
  shown below. Anchor |30| is an example of a border anchor.
  
\begin{codeexample}[]
\Huge
\begin{tikzpicture}
  \node[name=s,shape=nand gate IEC ,shape example, inner xsep=1cm, inner ysep=1cm,
    minimum height=6cm, nand gate IEC symbol=\color{black!30}\char`\&,
    logic gate inputs={in},
    logic gate inverted radius=0.65cm] 
  {Nand Gate\vrule width1pt height2cm};
  \foreach \anchor/\placement in
    {center/above, text/above, 30/above right,
     mid/right, mid east/left, mid west/above,
     base/below, base east/below, base west/left,
     north/above, south/below, east/above, west/above,
     north east/above, south east/below, south west/below, north west/above,
     output/right, input 1/above, input 2/below}
     \draw[shift=(s.\anchor)] plot[mark=x] coordinates{(0,0)}
       node[\placement] {\scriptsize\texttt{(s.\anchor)}};
\end{tikzpicture}
\end{codeexample}
\end{shape}
\end{pgflibrary}


\subsection{Electrical Engineering Circuits}

\subsubsection{Usage}

\subsubsection{IEC-Style Symbol Graphics}

\subsubsection{The Underlying Shape Libraries}




\endinput



