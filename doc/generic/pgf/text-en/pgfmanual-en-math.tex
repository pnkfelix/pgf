% Copyright 2007 by Mark Wibrow
%
% This file may be distributed and/or modified
%
% 1. under the LaTeX Project Public License and/or
% 2. under the GNU Free Documentation License.
%
% See the file doc/generic/pgf/licenses/LICENSE for more details.
%

\part{Mathetical Operations}
\pgfname{} supports mathematical operations beyond simple addition,
subtraction, multiplication and division, using both integers and 
non-integers. In addition, \pgfname{} can calculate functions such
as square-roots, sine, cosine, and generate pseudo-random numbers, 
both as ``stand-alone'' macros, and as infix operations in the 
arguments of certain commands.
\newpage

\section{Mathematics in PGF}
Those familiar with the \calcname{} package, know that it is 
possible to parse basic infix mathematical arithmatic operations, 
in the arguments of certain macros. 
However, \calcname{} operates under fairly constrained input. 
For example, only the |+|, |-|, |*| and |/| operators are supported, 
all non-integers must be followed by a \TeX{} dimension, and the 
second operand in a multiplication or division operation can only be
 an integer. 

\pgfname{} provides enhanced functionality, which permits the parsing
of mathematical operations involving integers and non-integers 
with or without units. Futhermore, various functions, including
trigonometic functions and random number generators can also be 
parsed (see Section~\ref{pgfmath-parsing}). 
The \calcname{} macros |\setlength| and friends have \pgfname{} versions 
which can parse these operations and functions 
(see Section~\ref{pgfmath-registers}). Additionally, each operation
and function has an independent \pgfname{} command associated with it
(see Section~\ref{pgfmath-commands}), and can be 
accessed outside the parser.

Currently, the mathematical algorithms are all implemented in \TeX.
This poses some intriguing programming challenges as \TeX{} is a
typesetting language not a mathematical one, and as with any 
programming language, there is a trade-off between accuracy and 
efficiency. Some levels of accuracy may not be your liking. 
However, it is very simple to replace them. In fact, the interface to 
the mathematical operations and functions has been deliberately 
implemented in a transparently enacpsualted manner, for precisely this 
purpose. For more details see Section~\ref{pgfmath-reimplement}.

\subsection{Setting Registers}

\label{pgfmath-registers}

These macros are very similar to their cousins in the \calcname{} 
package. The only difference is that the expressions that than can be
used to determine the values assigned to the registers, can be more
complex mathematical expressions, including functions and 
non-integers, as described in Section~\ref{pgfmath-parsing}. 

\begin{command}{\pgfmathsetlength\marg{dimension register}\marg{expression}}
Sets the length of the \TeX{} \meta{dimension register}, to the value
(in points) specified by \meta{expression}. 
Section~\ref{pgfmath-parsing}, provides details of syntax for
\meta{expression}.
\end{command}

\begin{command}{\pgfmathaddtolength\marg{dimension register}\marg{expression}}
	Adds the value (in points) of \meta{expression} to the \TeX{} 
	\meta{dimension register}.
\end{command}

\begin{command}{\pgfmathsetcount\marg{count register}\marg{expression}}
	Sets the value of the \TeX{} \meta{count register}, to the 
	\emph{truncated} value specified by \meta{expression}. 
\end{command}

\begin{command}{\pgfmathaddtocount\marg{count register}\marg{expression}}
	Adds the \emph{truncated} value  of \meta{expression} to the \TeX{} 
\	meta{count register}.
\end{command}

\begin{command}{\pgfmathsetcounter\marg{counter}\marg{expression}}
	Sets the value of the \meta{counter}, to the \emph{truncated} value 
	specified by \meta{expression}. 
\end{command}

\begin{command}{\pgfmathaddtocounter\marg{counter}\marg{expression}}
	Adds the \emph{truncated} value  of \meta{expression} to 
	\meta{counter}.
\end{command}

\begin{command}{\pgfmathnewcounter\marg{counter}}
	This is simply a version of the \LaTeX{} macro |\newcounter|, 
	implemented	entirely to maintain consistency (consistency is good,
	inconsistency is evil). Considering |\pgfmathnewcounter{foo}|, this
	creates a new count register |\c@foo|, and a macro |\thefoo|, which
	returns the value in |\c@foo|.
\end{command}

\begin{command}{\pgfmathsetmacro\marg{macro}\marg{expression}}
	Defines \meta{macro} as the  value of \meta{expression}. The result
	is a decimal \emph{without} units.
\end{command}

All the fancy mathematical ``bells-and-whistles'' that the parser 
provides, come with an additional processing cost, and in some
instances, such as simply setting a length to |1cm|, with no other
operations involved, the addition processing time is undesirable. 
To overcome this, the following feature is implemented: when no
mathematical operations are required, the value in \meta{expression}
can be preceded by |+|. This will bypass the parsing process and the 
assignment will be orders of magnitude faster. This feature 
\emph{only} works with the macros for setting registers described in
this section.

\begin{codeexample}[code only]
\pgfmathsetlength\mydimen{1cm}  % parsed     : slower.
\pgfmathsetlength\mydimen{+1cm} % not parsed : much faster.
\end{codeexample}

\input{pgfmanual-en-math-parsing.tex}

\input{pgfmanual-en-math-commands.tex}

\input{pgfmanual-en-math-algorithms.tex}

\input{pgfmanual-en-math-bases.tex}