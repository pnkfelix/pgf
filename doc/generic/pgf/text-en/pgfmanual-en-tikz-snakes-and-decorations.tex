% Copyright 2008 by Mark Wibrow
%
% This file may be distributed and/or modified
%
% 1. under the LaTeX Project Public License and/or
% 2. under the GNU Free Documentation License.
%
% See the file doc/generic/pgf/licenses/LICENSE for more details.

\section{Deformed and Decorated Paths}

\label{section-tikz-snakes-and-decorations}

\subsection{Overview}


Snakes will be completely replaced by decorations soon. So, let's
concentrate on decorations...



\subsection{Snakes}

\label{section-tikz-snakes}

To be revised...


The line-to operation can not only be used to append straight lines to
the path, but also ``snaked'' lines like this one:
\tikz\draw[snake=snake] (0,0) -- (1,0);. They are called ``snakes''
because they look a little bit like snakes seen from above.

\tikzname\ and \pgfname\ use a concept that I termed \emph{snakes}
for appending such ``squiggly'' lines. A snake specifies a way of
extending a path between two points in a ``fancy manner.''

Normally, a snake will just connect the start point to the end point
without starting new subpaths. Thus, a path containing a snaked line
can, nevetheless, still be used for filling. However, this is not
always the case. Some snakes consist of numerous unconnected
segments. ``Lines'' consisting of such snakes cannot be used as the
borders of enclosed areas.

Here are some examples of snakes in action:

\begin{codeexample}[]
\begin{tikzpicture}[thick]
  \draw                                        (0,3)   -- (3,3);
  \draw[snake=zigzag]                          (0,2.5) -- (3,2.5);
  \draw[snake=brace]                           (0,2)   -- (3,2);
  \draw[snake=triangles]                       (0,1.5) -- (3,1.5);
  \draw[snake=coil,segment length=4pt]         (0,1)   -- (3,1);
  \draw[snake=coil,segment aspect=0]           (0,.5)  -- (3,.5);
  \draw[snake=expanding waves,segment angle=7] (0,0)   -- (3,0);
\end{tikzpicture}
\end{codeexample}

\begin{codeexample}[]
\begin{tikzpicture}
  \filldraw[fill=red!20,snake=bumps] (0,0) rectangle (3,2);
\end{tikzpicture}
\end{codeexample}

\begin{codeexample}[]
\begin{tikzpicture}
  \filldraw[fill=blue!20]              (0,3)
  [snake=saw]                       -- (3,3)
  [snake=coil,segment aspect=0]     -- (2,1)
  [snake=bumps]                     -| (0,3);
\end{tikzpicture}
\end{codeexample}

\begin{codeexample}[]
\begin{tikzpicture}
  \filldraw [fill=yellow!50,
             snake=random steps,segment length=3pt,segment amplitude=1pt]
     (0,0) rectangle (3,2);
  \node at (1.5,1) {Saved from trash};
\end{tikzpicture}
\end{codeexample}

\begin{codeexample}[]
\begin{tikzpicture}
  \shade [left color=green,right color=black,
          snake=random steps,segment length=1mm,segment amplitude=3mm]
    (0,0) rectangle (3,2);
\end{tikzpicture}
% You do not want to meet this snake on a dark street...          
\end{codeexample}

No special path operation is needed to use a snake. Instead, you use
the following option to ``switch on'' snaking:

\begin{key}{/tikz/snake=\meta{snake name} (default \normalfont is scope's
  snake)}
  This option causes the snake \meta{snake name} to be used for
  subsequent line-to operations. So, whenever you use the |--| syntax
  to specify that a straight line should be added to the path, a snake
  to this path will be added instead. Snakes will also be used when
  you use the \verb!-|! and \verb!|-! syntax and also when you use the
  |rectangle| operation. Snakes will \emph{not} be used when you use
  the curve-to operation nor when any other ``curved'' line is added
  to the path.

  This option has to be given anew for each path. However, you can
  also leave out the \meta{snake name}. In this case, the enclosing
  scope's \meta{snake name} is used. Thus, you can specify a
  ``standard'' snake name for scope and then just say |\draw[snake]|
  every time this snake should actually be used.

  The \meta{snake name} |none| is special. It can be used to switch
  off snaking after it has been switched on on a path.

  A bit strangely, no valid \meta{snake names} are defined by
  \tikzname\ by default. Instead, you have to include the library
  package |pgflibrarysnakes|. This package defines numerous snakes,
  see Section~\ref{section-library-snakes} for the complete list.
\end{key}

Most snakes can be configured. For example, for a snake that looks
like a sine curve, you might wish to change the amplitude or the
frequency. There are numerous options that influence these
parameters. Not all options apply to all snakes, see
Section~\ref{section-library-snakes} once more for details.

\begin{key}{/tikz/gap before snakes=\meta{dimension}}
  This option allows you to add a certain ``gap'' to the snake at its
  beginning. The snake will not start at the current point; instead
  the start point of the snake is move be \meta{dimension} in the
  direction of the target.
\begin{codeexample}[]
\begin{tikzpicture}
  \draw[help lines] (0,0) grid (3,2);
  \draw[snake=zigzag]                      (0,1) -- ++(3,1);
  \draw[snake=zigzag,gap before snake=1cm] (0,0) -- ++(3,1);
\end{tikzpicture}
\end{codeexample}
\end{key}

\begin{key}{/tikz/gap after snake=\meta{dimension}}
  This option has the same effect as |gap before snake|, only it
  affects the end of the snake, which will ``end early.''
\end{key}
\begin{key}{/tikz/gap around snake=\meta{dimension}}
  This option sets the gap before and after the gap to
  \meta{dimension}. 
\begin{codeexample}[]
\begin{tikzpicture}
  \draw[help lines] (0,0) grid (3,2);
  \draw[snake=brace]                      (0,1) -- ++(3,1);
  \draw[snake=brace,gap around snake=5mm] (0,0) -- ++(3,1);
\end{tikzpicture}
\end{codeexample}
\end{key}
\begin{key}{/tikz/line before snake=\meta{dimension}}
  This option works like |gap before snake|, only it will connect the
  current point with a straight line to the start of the snake.
\begin{codeexample}[]
\begin{tikzpicture}
  \draw[help lines] (0,0) grid (3,2);
  \draw[snake=zigzag]                       (0,1) -- ++(3,1);
  \draw[snake=zigzag,line before snake=1cm] (0,0) -- ++(3,1);
\end{tikzpicture}
\end{codeexample}
\end{key}
\begin{key}{/tikz/line after snake=\meta{dimension}}
  Works line |gap after snake|, only it adds a straight line.
\end{key}
\begin{key}{/tikz/line around snake=\meta{dimension}}
  Works line |gap around snake|, only it adds straight lines.
\end{key}
\begin{key}{/tikz/raise snake=\meta{dimension}}
  This option can be used with all snakes. It will offset the snake by
  ``raising'' it by \meta{dimension}. A negative \meta{dimension} will
  lower the snake. Raising and lowering is always relative to the line
  along which the snake is drawn. Here is an example:
\begin{codeexample}[]
\begin{tikzpicture}
  \node (a) {A};
  \node (b) at (2,1) {B};
  \draw                                  (a) -- (b);
  \draw[snake=brace]                     (a) -- (b);
  \draw[snake=brace,raise snake=5pt,red] (a) -- (b);
\end{tikzpicture}
\end{codeexample}
\end{key}
\begin{key}{/tikz/mirror snake}
  This option causes the snake to be ``reflected along the path.''
  This is best understood by looking at an example:
\begin{codeexample}[]
\begin{tikzpicture}
  \node (a) {A};
  \node (b) at (2,1) {B};
  \draw                                     (a) -- (b);
  \draw[snake=brace]                        (a) -- (b);
  \draw[snake=brace,mirror snake,red,thick] (a) -- (b);
\end{tikzpicture}
\end{codeexample}
  This option can be used with every snake and can be combined with
  the |raise snake| option.
\end{key}


\begin{key}{/pgf/segment amplitude=\meta{dimension} (initially 2.5pt)}
  \keyalias{tikz}  
  This option sets the ``amplitude'' of the snake. For a snake that is
  a sine wave this would be the amplitude of this line. For other
  snakes this value typically describes how far the snakes ``rises
  above'' or ``falls below'' the path. For some snakes, this value is
  ignored. 
\begin{codeexample}[]
\begin{tikzpicture}
  \node (a) {A}   node (b) at (2,1) {B}  node (c) at (2,-1) {C};
  \draw[snake=zigzag]                                 (a) -- (b);
  \draw[snake=zigzag,segment amplitude=5pt,red,thick] (a) -- (c);
\end{tikzpicture}
\end{codeexample}
\end{key}

\begin{key}{/pgf/segment length=\meta{dimension} (initially 10pt)}
  \keyalias{tikz}
  This option sets the length of each ``segment'' of a snake. For a
  sine wave this would be the wave length, for other snakes it is the
  length of each ``repetitive part'' of the snake.
\begin{codeexample}[]
\begin{tikzpicture}
  \node (a) {A}   node (b) at (2,1) {B}  node (c) at (2,-1) {C};
  \draw[snake=zigzag]                               (a) -- (b);
  \draw[snake=zigzag,segment length=20pt,red,thick] (a) -- (c);
\end{tikzpicture}
\end{codeexample}
\begin{codeexample}[]
\begin{tikzpicture}
  \node (a) {A}   node (b) at (2,1) {B}  node (c) at (2,-1) {C};
  \draw[snake=bumps]                               (a) -- (b);
  \draw[snake=bumps,segment length=20pt,red,thick] (a) -- (c);
\end{tikzpicture}
\end{codeexample}
\end{key}

\begin{key}{/pgf/segment object length=\meta{dimension} (initially
    \normalfont same as |/pgf/segment amplitude|)}
  \keyalias{tikz}
  This option sets the length of the objects inside each segment of a
  snake. This option is only used for snakes in which each segment
  contains an object like a triangle or a star. 
\begin{codeexample}[]
\begin{tikzpicture}
  \node (a) {A}   node (b) at (2,1) {B}  node (c) at (2,-1) {C};
  \draw[snake=triangles]                                     (a) -- (b);
  \draw[snake=triangles,segment object length=8pt,red,thick] (a) -- (c);
\end{tikzpicture}
\end{codeexample}
\end{key}

\begin{key}{/pgf/segment angle=\meta{degrees} (initially 45)}
  \keyalias{tikz}
  This option sets an angle that is interpreted in a snake-specific
  way. For example, the |waves| and |expanding waves| snakes interpret
  this as (half the) opening angle of the wave. The |border| snake
  uses this value for the angle of the little ticks.
\begin{codeexample}[]
\begin{tikzpicture}[segment amplitude=10pt]
  \node (a) {A}   node (b) at (2,0) {B};
  \draw[snake=border]                            (a) -- (b);
  \draw[snake=border,segment angle=20,red,thick] (a) -- (b);
\end{tikzpicture}
\end{codeexample}
\begin{codeexample}[]
\begin{tikzpicture}[segment amplitude=10pt]
  \node (a)            {A}   node (b)  at (2,0)  {B};
  \node (a') at (0,-1) {A}   node (b') at (2,-1) {B};
  \draw[snake=expanding waves]                            (a)  -- (b);
  \draw[snake=expanding waves,segment angle=20,red,thick] (a') -- (b');
\end{tikzpicture}
\end{codeexample}
\end{key}

\begin{key}{/pgf/segment aspect=\meta{ratio} (initially 0.5)}
  \keyalias{tikz}
  This option sets an aspect ratio that is interpreted in a
  snake-specific way. For example, for the |coils| snake this
  describes the ``direction'' from which the coil is viewed.
\begin{codeexample}[]
\begin{tikzpicture}[segment amplitude=5pt,segment length=5pt]
  \node (a) {A}   node (b) at (2,1) {B}  node (c) at (2,-1) {C};
  \draw[snake=coil]                            (a) -- (b);
  \draw[snake=coil,segment aspect=0,red,thick] (a) -- (c);
\end{tikzpicture}
\end{codeexample}
\end{key}

It is possible to define new snakes, but this cannot be done inside
\tikzname. You need to use the command |\pgfdeclaresnake| from the
basic level directly, see Section~\ref{section-base-snakes}.

The following styles define combinations of segment settings that may
be useful:
\begin{stylekey}{/tikz/snake triangles 45}
  Installs a snake the consists of little triangles with an opening
  angle of $45^\circ$.
\end{stylekey}

\begin{stylekey}{/tikz/snake triangles 60}
  Installs a snake the consists of little triangles with an opening
  angle of $60^\circ$.
\end{stylekey}

\begin{stylekey}{/tikz/snake triangles 90}
  Installs a snake the consists of little triangles with an opening
  angle of $90^\circ$.
\end{stylekey}




\subsection{Decorations}

This will be the main text of this section.


\begin{tikzlibrary}{decorations}
  This library enables decorations to be used in \tikzname\ and also
  installs a number of decorations, see
  Section~\ref{section-library-decorations} for a complete list.
\end{tikzlibrary}

In order to decorate (part of) a path, you use the following path
command:

\begin{pathoperation}{decorate}{\opt{\oarg{options}}\marg{subpath}}
  This path operation causes the \meta{subpath} to be
  decorated. Depending on the decoration, this may or may not extend
  the current path.

  The path can include straight lines, curves,
  rectangles, arcs, circles and ellipses. However, rectangles, circles 
  and ellipses may not be decorated succesfully with `continuous' 
  decorations (i.e., those that do not create multiple segmented 
  subpaths). In addition, due to the limits on the precision in 
  \TeX, some inaccuraces in positioning when crossing subpath 
  boundaries may occasionally be found.
  
  More details...
\end{pathoperation}

\begin{key}{/tikz/decorate=\opt{\meta{boolean}} (default true)}
  When this key is set, the whole path is decorated after it has been
  finished. The decoration used for decorating the path is set via the
  |decoration| or the |meta-decoration| key.

  More details.
\end{key}

\begin{key}{/tikz/decoration=\meta{name}}
  This option causes the decoration \meta{name} to be used
  for decorating paths. In order to actually use the decoration, you
  have to use the |decorate| option or path command, explicitly.
	
\begin{codeexample}[]
\begin{tikzpicture}
  \draw [help lines] grid (3,2);
  \draw decorate [decoration=zigzag]
         { (0,0) .. controls (0,2) and (3,0) .. (3,2) };
\end{tikzpicture}
\end{codeexample}
 
  The special decoration, called |none|, causes no decorations to be
  added. 
  
  It is important to remember that the path that is specified for
  the decoration is destroyed when it is decorated, so it cannot be 
  subsequently drawn or filled. 
  
  Successful use of a decoration, may depend on knowing something
  about the decoration, in particular whether it draws, or 
  fills	the path it creates. A decoration which does not use its
  own path must be used with |draw| or |fill| otherwise nothing will 
  appear.
  The |zigzag| decoration, shown above, is an example of a 
  decoration which does not do anything with its own path. Thus, the
  path command |\draw| is used. Note, that some decorations do not
  create a path	at all:	
  
\begin{codeexample}[]
\begin{tikzpicture}
  \tikzset{decoration=text,
           decoration text=around and around and around and around we go}
  \draw [help lines] grid (3,2);
  \path decorate {(0,1) arc (180:-180:1.5cm and 1cm)};
\end{tikzpicture}
\end{codeexample}

  Considering the above example, it might be nice to have the line as
  well. Of course, the line should be behind the text, so |postaction|
  can be used for the decoration.
  
\begin{codeexample}[]
\catcode`\|12
\begin{tikzpicture}
\draw [help lines] grid (3,2);
\draw [red, dashed, postaction={decorate,decoration=text, 
  decoration text=around and around and around and around we go}] 
  (0,1) arc (180:-180:1.5cm and 1cm);
\end{tikzpicture}
\end{codeexample} 
\end{key}

\begin{key}{/tikz/meta-decoration=\marg{name}}
  This key works like |decoration|, only it sets a meta-decoration
  rather than a decoration for use with the |decorate| option or path
  command. Whereas a decoration (typically) decorates a path
  with another path, a meta-decoration decorates a path with
  decoration automatons. The ultimate effect, however, is to create a
  new path. 

\begin{codeexample}[]
\begin{tikzpicture}  
  \draw [help lines] grid (3,2);
  \draw[meta-decoration=lineto zigzag, decoration segment length=.125cm,
        meta-decoration segment length=\pgfmetadecoratedpathlength/8]
    decorate {(1,0) arc (270:90:1cm) -- (2,2) arc (90:-90:1cm)--cycle};
\end{tikzpicture}
\end{codeexample}
\end{key}



